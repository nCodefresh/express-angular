version: '1.0'

steps:

  generate-tag:
    image: node:latest
    working-directory: ${{initial-clone}}
    commands:
        - echo "start-command"
        - bash -c 'export TAG=1234 && echo "start" && echo $TAG'
        - echo "stop-command"
        - echo ${{CF_BRANCH}}
#        - echo ${{TAG}}
#        - bash -c "export TAG=$(echo '12345678910111' | cut -c1-8)"
#        - bash -c "echo $TAG"


  build-project:
    type: build
    working-directory: ${{initial-clone}}
    description: codefresh example
    image-name: ncodefresh/express-angular
    dockerfile: Dockerfile
    tag: ${{TAG}}


  push-to-dockerhub:
    type: push
    candidate: ${{build-project}}
    tag: ${{TAG}}
