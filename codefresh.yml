version: '1.0'

steps:
  build_prj:
    type: build
    title: 123 сборка
    description: UC - build step
    image_name: codefreshio/yaml-example-test
    dockerfile: Dockerfile
    working-directory: ${{initial-clone}}
    tag: ${{CF-BRANCH}}
    when:
      branch:
        only:
          - [name-literals]
#        ignore:
#          - name-literals

  freestyle_step:
    image: node:latest
    title: 'qwerty ajsjfj djfjf \ \n jjf \\n djaksd \t'
    working_directory: ${{initial_clone}}
    fail-fast: false
    environment:
      - TEST-A=test
    commands:
        - npm -v
        - echo $TEST-A
        - echo ${{TEST-A}}
    when:
      condition:
        all:
          name: "'${{CF_BRANCH}}' != 'condition-step'"
          noSkipCiInCommitMessage: 'includes(lower("${{CF_COMMIT_MESSAGE}}"), "skip ci") == false'
          masterBranch: '"${{CF_BRANCH}}" != "master"'

  composition_step:
      title: "asd dgfhfj skdkd fsdf"
      description: Attempting to run as part of composition.
      type: composition
      fail-fast: false
      composition:
        version: '2'
        services:
          app-name:
            image: 'advance512demo/demochat:master'
            ports:
              - 5000
            depends_on:
              - mongodb
          mongodb:
            image: mongo
      composition_candidates:
        main:
          image: nhoag/curl
          command: bash -c "sleep 20 && curl http://app:5000/" | echo 'works'
      when:
        condition:
          any:
            noSkipCiInCommitMessage: 'includes(lower("${{CF_COMMIT_MESSAGE}}"), "skip ci") == false'
            notFeatureBranch: 'match("${{CF_BRANCH}}", "^FB-", true) == false'

  push_step:
    title: yturi "dhfjg
    description: Pushing image to Docker hub.
    type: push
    candidate: ${{build_prj}}
    tag: ${{CF_BRANCH}}
    fail-fast: false
    when:
      branch:
        ignore: [master, develop]

  launch_compose:
    title: ryutit "nfhdjg"#$ `iuyo$ #sdf
    type: launch-composition
    environmentName: ENV-test
    when:
      branch:
        ignore: [ master, other]
    composition:
        version: '2'
        services:
          app-name:
            image: ${{build_prj}}
            ports:
              - 3000