version: '1.0'

steps:

  build-project:
    type: build
    working-directory: ${{initial-clone}}
    description: codefresh example
    image-name: ncodefresh/express-angular-test
    dockerfile: Dockerfile
    tag: ${{CF_SHORT_REVISION}}

  launch-env:
      type: launch-composition
      composition: 'express-angular'
      environmentName: 'new-launch-env'

  inline-composition:
      type: launch-composition
      composition:
        version: '2'
        services:
          db:
            image: ${{build-step}}
            ports:
             - 9000

  push-to-dockerhub:
    type: push
    candidate: ${{build-project}}
    tag: ${{CF_SHORT_REVISION}}
