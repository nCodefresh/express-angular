version: '1.0'
steps:
  generate-tag:
    image: node:latest
    working-directory: ${{main_clone}}
    commands:
      - cf_export TAG=qwerty=we TAG1='kskd=sd' TAG2=fhgjd USERNAME=ncodefresh 123=124
      - echo TEST=123456789 >> /codefresh/volume/env_vars_to_export
      - echo TEST1=12345678910 >> /codefresh/volume/env_vars_to_export

  alpine-freestyle-step:
      image: alpine
      commands:
        - cf_export TAG_ALPINE=alpine
        - echo TEST_APINE=17 >> ${{CF_VOLUME_PATH}}/env_vars_to_export

  build_step:
    type: build
    description: codefresh example
    working_directory: ${{main_clone}}
    image-name: ${{USERNAME}}/express-angular-test
    dockerfile: Dockerfile
    build_arguments:
      - arg=${{TEST_APINE}}

  generate-tag-1:
      image: node:latest
      working-directory: ${{main_clone}}
      commands:
        - echo ${TEST}
        - echo ${TAG}
        - echo ${TEST1}
        - echo ${123}
        - echo ${TAG_ALPINE}
        - echo ${TAG_ALPINE}

  push-to-dockerhub:
    type: push
    candidate: ${{build_step}}
    registry: docker-hub
    tags: [ latest, qwerty ]